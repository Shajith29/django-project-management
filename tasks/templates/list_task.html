{% extends "base.html" %}

{% block content %}
    <h2>Task for {{project.name}}</h2>

    <a href="{% url 'create_task' project.pk %}">Create Task</a>


    <h3>Filter Tasks</h3>

    <a href="?status=all" {% if status == "all"  %} style="font-weight: bold;" {% endif %}>
        All ({{ total_count }})
    </a> | 

      <a href="?status=pending" {% if status == "pending"  %} style="font-weight: bold;" {% endif %}>
        Pending ({{pending_count}})
    </a> | 

      <a href="?status=completed" {% if status == "completed"  %} style="font-weight: bold;" {% endif %}>
        Completed ({{completed_count}})
    </a> | 



    

    {% for task in tasks %}
        <li>
            {{task.title}}

            {% if not task.is_completed and  user == project.owner or task.assigned_to == user %}
                <a href="{% url 'edit_task' task.pk %}">Edit Task</a>
            {% endif %}
            {% if task.assigned_to %}
                Assinged To : {{task.assigned_to.username}}
            {% endif %}

            Status: 
            {% if task.is_completed %}
                Completed
            {% else  %}
                Pending
            {% endif %}

            {% if request.user == project.owner and not task.is_completed %}
                <a href="{% url 'assign_task' task.pk %}">Assign Task</a>
            {% endif %}

            
            {% if request.user == project.owner %}
                <form method="post" action="{% url 'delete_task' task.pk %}">
                    {% csrf_token %}
                    <button type="submit">Delete Task</button>
                </form>
            {% endif %}

            {% if not task.is_completed%}
                {% if user == project.owner or task.assigned_to == user%}
                    <form action="{% url 'complete_task' task.id %}" method="post" onsubmit="return confirm('Are you sure you want to mark this task as completed')">
                        {% csrf_token %}
                        <button type="submit">Mark as Completed</button>
                    </form>
                {% endif %}
            {% else %}
                    <p>
                        Task is Complted by {{task.completed_by.username}} at {{task.completed_at}}
                    </p>

            {% endif %}
        </li>
    {% empty %}
        <p>No Tasks to List</p>
    {% endfor %}

    <a href="{% url 'list_projects' %}">Back to Projects</a>

{% endblock %}